import{q as T,w as $,c as h,b,g as R,d as k,a as i,s as M,h as H,u as L,n as U}from"./CbR0rNbh.js";import{b as N}from"./CREfjt_9.js";const w=["winter","summer","fall"],O={winter:{label:"Winter",releaseStart:t=>`${t}-01-01`,releaseEnd:t=>`${t}-04-30`,draftMonth:11},summer:{label:"Summer",releaseStart:t=>`${t}-05-01`,releaseEnd:t=>`${t}-08-31`,draftMonth:3},fall:{label:"Fall",releaseStart:t=>`${t}-09-01`,releaseEnd:t=>`${t}-12-31`,draftMonth:7}};function Y(t,e){return`${t}-${e}`}function tt(t){const e=t.match(/^(winter|summer|fall)-(\d{4})$/);return e?{phase:e[1],season:e[2]}:null}function K(t){const e=w.indexOf(t);return e<w.length-1?w[e+1]:null}function et(t,e){const a=O[t];return{start:a.releaseStart(e),end:a.releaseEnd(e)}}function at(t,e){return t==="winter"?e+3:e+1}function st(t,e,a){return t==="winter"?e===1?"hitPick":e===2?"bombPick":e<=2+a?"seasonalPick":"altPick":e<=a?"seasonalPick":"altPick"}const W={2:8,3:6,4:4,5:3,6:2,7:2,8:2};function nt(t){return W[t]??2}function ot(t){return`${t}Picks`}function F(t,e=[]){const a=new Set(e),s=[];t.hitPick&&s.push(t.hitPick);const r=["winterPicks","summerPicks","fallPicks"];let c=0;for(const u of r){const D=t[u]??[];for(const g of D)if(a.has(g)){const p=(t.altPicks??[])[c];p&&s.push(p),c++}else s.push(g)}return s}const d="leagues",x="teams",z="drafts";function m(t){return k(i,d,t)}function G(t,e){return k(i,d,t,x,e)}function J(t,e){return k(i,d,t,z,e)}async function C(t){const e=await R(m(t));return e.exists()?{id:e.id,...e.data()}:null}async function rt(t){const e=T(h(i,d),$("code","==",t.trim().toUpperCase())),a=await b(e);if(a.empty)return null;const s=a.docs[0];return{id:s.id,...s.data()}}async function ct(t){const e=T(h(i,d),$("members","array-contains",t));return(await b(e)).docs.map(s=>({id:s.id,...s.data()}))}async function Q(t){return(await b(h(i,d,t,x))).docs.map(a=>({id:a.id,...a.data()}))}async function _(t,e,a){const s=await R(J(t,Y(e,a)));return s.exists()?s.data().status:null}async function V(t,e){for(const a of w)if(await _(t,a,e)==="completed")return!0;return!1}async function it(t,e){const a={};for(const s of w)a[s]=await _(t,s,e);return a}function q(){return{winterPicks:[],summerPicks:[],fallPicks:[],altPicks:[]}}function X(){const t=new Date;return(t.getMonth()===11?t.getFullYear()+1:t.getFullYear()).toString()}async function ut(t,e,a,s,r="My Studio"){const c=k(h(i,d)),u={name:e,code:a.trim().toUpperCase(),commissionerId:t,settings:s,season:X(),status:"draft",currentPhase:"winter",members:[t],delistedGames:[],createdAt:H()};return await M(c,u),await M(G(c.id,t),{name:r.trim()||"My Studio",picks:q(),score:0,bombAdjustment:0}),c.id}async function ft(t,e,a="My Studio"){const s=await R(m(t));if(!s.exists())throw new Error("League not found");const r=s.data();if(r.members.includes(e))return;if(await V(t,r.season))throw new Error("Cannot join a league that is already in progress.");await L(m(t),{members:[...r.members,e]}),await M(G(t,e),{name:a.trim()||"My Studio",picks:q(),score:0,bombAdjustment:0})}async function dt(t){const e=await C(t);if(!e)throw new Error("League not found");const a=K(e.currentPhase);a?await L(m(t),{currentPhase:a,status:"active"}):await L(m(t),{status:"completed"})}async function lt(t){await U(m(t))}async function mt(t){const e=await C(t),a=await Q(t),s=e?.delistedGames??[],r=new Map,c=new Set;for(const n of a)F(n.picks,s).forEach(f=>c.add(f));const u=new Map;for(const n of c)try{const o=await N(n);u.set(n,o.map(f=>({date:f.date||"",points:f.dailyPoints})))}catch{}const D=await b(h(i,"leagues",t,"scoring")),g=new Map;for(const n of D.docs){const o=n.data();o.bombAdjustments&&g.set(o.date??n.id,o.bombAdjustments)}const p=new Set;u.forEach(n=>{n.forEach(o=>p.add(o.date))});const A=Array.from(p).sort();for(const n of a)r.set(n.id,new Map);for(let n=0;n<A.length;n++){const o=A[n],f=n>0?A[n-1]:null,j=new Map;for(const l of a){const P=F(l.picks,s);let y=0;for(const E of P){const S=u.get(E)?.find(B=>B.date===o);S&&(y+=S.points)}j.set(l.id,y)}const v=g.get(o)??{};for(const l of a){const P=r.get(l.id),y=f?P.get(f)??0:0,E=j.get(l.id)??0,S=v[l.id]??0;P.set(o,y+E+S)}}return r}export{w as D,O as P,C as a,nt as b,ut as c,J as d,dt as e,ot as f,rt as g,at as h,et as i,ft as j,st as k,ct as l,it as m,Q as n,mt as o,tt as p,Y as q,lt as r,F as s,G as t};
