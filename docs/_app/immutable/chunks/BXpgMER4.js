import{_ as I}from"./PPVm8Dsz.js";import{a as R,f as w,q as G,o as C,b as B,d as L,e as v}from"./CUsvRYbg.js";let m=null,d=null;async function u(){if(m&&d)return{gamesData:m,gamesById:d};try{const s=(await I(async()=>{const{default:r}=await import("./BAsd2ghB.js");return{default:r}},[],import.meta.url)).default;return m=s,d=new Map(s.games.map(r=>[r.id,r])),{gamesData:m,gamesById:d}}catch{return m=null,d=null,{gamesData:{games:[]},gamesById:new Map}}}function b(){m=null,d=null}const E=3,T=500;let f=null;async function h(s=0){try{const r=await L(v(w,"meta","scores"));return r.exists()?r.data().scores??{}:{}}catch{if(s<E-1){const e=T*Math.pow(2,s);return await new Promise(a=>setTimeout(a,e)),h(s+1)}return{}}}function S(){return f||(f=h().catch(s=>(f=null,{}))),f}function q(){f=null}async function F(s){const{gamesById:r}=await u(),e=r.get(s)??null;if(!e)return null;const a=await S();return{...e,id:s,score:a[s]??null}}async function H(){const{gamesData:s}=await u();return[...new Set(s.games.map(e=>e.releaseDate?.slice(0,4)).filter(e=>!!e&&/^\d{4}$/.test(e)).map(e=>parseInt(e,10)))].sort((e,a)=>a-e)}async function Y(s){const{gamesData:r}=await u(),e=String(s),a=new Set;for(const i of r.games)if(i.releaseDate?.startsWith(e))for(const t of i.genres??[])a.add(t);return[...a].sort()}async function O(s,r){const{gamesData:e}=await u(),a=String(s),i=await S();let t=e.games.filter(o=>o.releaseDate?.startsWith(a));return r?.genres?.length&&(t=t.filter(o=>r.genres.some(g=>(o.genres??[]).includes(g)))),t.map(o=>({id:o.id,name:o.name,releaseDate:o.releaseDate??null,coverUrl:o.coverUrl??null,score:i[o.id]??null}))}async function A(s,r,e,a){const i=a?.genres?.length?{genres:a.genres}:void 0;let t=await O(s,i);if(a?.releaseFrom&&(t=t.filter(n=>(n.releaseDate??"")>=a.releaseFrom)),a?.releaseTo&&(t=t.filter(n=>(n.releaseDate??"")<=a.releaseTo)),a?.hideReleased){const n=new Date().toISOString().split("T")[0];t=t.filter(c=>{const l=c.releaseDate??"";return!l||l>n})}if(a?.bookmarkedOnly&&a?.bookmarkedIds&&(t=t.filter(n=>a.bookmarkedIds.has(n.id))),a?.search?.trim()){const n=a.search.trim().toLowerCase();t=t.filter(c=>c.name.toLowerCase().includes(n))}const o=a?.sortBy??"date",_=(a?.order??"asc")==="asc"?1:-1;t=[...t].sort((n,c)=>{let l=0;if(o==="id")l=(n.id??"").localeCompare(c.id??"");else if(o==="name")l=(n.name??"").localeCompare(c.name??"",void 0,{sensitivity:"base"});else if(o==="date")l=(n.releaseDate??"").localeCompare(c.releaseDate??"");else{const y=n.score??-1/0,D=c.score??-1/0;l=y===D?0:y<D?-1:1}return l*_});const p=t.length;return{games:t.slice(e,e+r),total:p}}async function U(s){const{gamesById:r}=await u();return r.get(s)?.isHidden===!0}async function W(s){const r=R(w,"games",s,"history"),e=G(r,C("date","asc"));return(await B(e)).docs.map(i=>{const t=i.data();return{owners:t.estimatedOwners??0,ownersDelta:t.salesDelta??0,ccu:t.ccu??0,daysSinceRelease:t.daysSinceRelease??0,dailyPoints:t.points??0,date:t.date??i.id}})}async function x(){const{gamesData:s}=await u(),r=new Date().toISOString().split("T")[0];return s.games.filter(e=>!e.isHidden&&e.releaseDate&&e.releaseDate>=r).sort((e,a)=>(e.releaseDate??"").localeCompare(a.releaseDate??"")).map(e=>({...e,id:e.id}))}export{F as a,Y as b,A as c,x as d,H as e,b as f,W as g,U as i,q as r};
