import{q as G,w as T,c as p,g as h,a as M,d as D,b as c,s as P,e as Y,u as A,f as N}from"./2_D5sMpC.js";import{D as x,g as L,a as _,b as z,c as J}from"./ExmRRWdh.js";const d="leagues",R="teams",K="drafts";function m(t){return D(c,d,t)}function v(t,a){return D(c,d,t,R,a)}function O(t,a){return D(c,d,t,K,a)}async function C(t){const a=await M(m(t));return a.exists()?{id:a.id,...a.data()}:null}async function $(t){const a=G(p(c,d),T("code","==",t.trim().toUpperCase())),s=await h(a);if(s.empty)return null;const e=s.docs[0];return{id:e.id,...e.data()}}async function I(t){const a=G(p(c,d),T("members","array-contains",t));return(await h(a)).docs.map(e=>({id:e.id,...e.data()}))}async function Q(t){return(await h(p(c,d,t,R))).docs.map(s=>({id:s.id,...s.data()}))}async function F(t,a,s){const e=await M(O(t,z(a,s)));return e.exists()?e.data().status:null}async function V(t,a){for(const s of x)if(await F(t,s,a)==="completed")return!0;return!1}async function tt(t,a){const s={};for(const e of x)s[e]=await F(t,e,a);return s}function q(){return{winterPicks:[],summerPicks:[],fallPicks:[],altPicks:[]}}function W(){const t=new Date;return(t.getMonth()===11?t.getFullYear()+1:t.getFullYear()).toString()}async function at(t,a,s,e,r="My Studio"){const i=D(p(c,d)),g={name:a,code:s.trim().toUpperCase(),commissionerId:t,settings:e,season:W(),status:"draft",currentPhase:"winter",members:[t],delistedGames:[],createdAt:Y()};return await P(i,g),await P(v(i.id,t),{name:r.trim()||"My Studio",picks:q(),score:0,bombAdjustment:0}),i.id}async function st(t,a,s="My Studio"){const e=await M(m(t));if(!e.exists())throw new Error("League not found");const r=e.data();if(r.members.includes(a))return;if(await V(t,r.season))throw new Error("Cannot join a league that is already in progress.");await A(m(t),{members:[...r.members,a]}),await P(v(t,a),{name:s.trim()||"My Studio",picks:q(),score:0,bombAdjustment:0})}async function et(t){const a=await C(t);if(!a)throw new Error("League not found");const s=J(a.currentPhase);s?await A(m(t),{currentPhase:s,status:"active"}):await A(m(t),{status:"completed"})}async function nt(t){await N(m(t))}async function ot(t){const a=await C(t),s=await Q(t),e=a?.delistedGames??[],r=new Map,i=new Set;for(const n of s)L(n.picks,e).forEach(u=>i.add(u));const g=new Map;for(const n of i)try{const o=await _(n);g.set(n,o.map(u=>({date:u.date||"",points:u.dailyPoints})))}catch{}const B=await h(p(c,"leagues",t,"scoring")),j=new Map;for(const n of B.docs){const o=n.data();o.bombAdjustments&&j.set(o.date??n.id,o.bombAdjustments)}const k=new Set;g.forEach(n=>{n.forEach(o=>k.add(o.date))});const S=Array.from(k).sort();for(const n of s)r.set(n.id,new Map);for(let n=0;n<S.length;n++){const o=S[n],u=n>0?S[n-1]:null,E=new Map;for(const f of s){const l=L(f.picks,e);let w=0;for(const b of l){const y=g.get(b)?.find(U=>U.date===o);y&&(w+=y.points)}E.set(f.id,w)}const H=j.get(o)??{};for(const f of s){const l=r.get(f.id),w=u?l.get(u)??0:0,b=E.get(f.id)??0,y=H[f.id]??0;l.set(o,w+b+y)}}return r}export{C as a,et as b,at as c,O as d,I as e,tt as f,$ as g,Q as h,ot as i,st as j,nt as k,v as t};
