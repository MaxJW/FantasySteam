import{_}from"./PPVm8Dsz.js";import{c as h,b as g,q as R,o as I,g as C,a as B,d as G}from"./D36JPk-d.js";let l=null,m=null;async function d(){if(l&&m)return{gamesData:l,gamesById:m};try{const a=(await _(async()=>{const{default:s}=await import("./BAsd2ghB.js");return{default:s}},[],import.meta.url)).default;return l=a,m=new Map(a.games.map(s=>[s.id,s])),{gamesData:l,gamesById:m}}catch{return l=null,m=null,{gamesData:{games:[]},gamesById:new Map}}}function q(){l=null,m=null}const E=3,L=500;let u=null;async function D(a=0){try{const s=await B(G(g,"meta","scores"));return s.exists()?s.data().scores??{}:{}}catch{if(a<E-1){const e=L*Math.pow(2,a);return await new Promise(r=>setTimeout(r,e)),D(a+1)}return{}}}function w(){return u||(u=D().catch(a=>(u=null,{}))),u}function F(){u=null}async function H(a){const{gamesById:s}=await d(),e=s.get(a)??null;if(!e)return null;const r=await w();return{...e,id:a,score:r[a]??null}}async function Y(){const{gamesData:a}=await d();return[...new Set(a.games.map(e=>e.releaseDate?.slice(0,4)).filter(e=>!!e&&/^\d{4}$/.test(e)).map(e=>parseInt(e,10)))].sort((e,r)=>r-e)}async function T(a){const{gamesData:s}=await d(),e=String(a),r=await w();return s.games.filter(t=>t.releaseDate?.startsWith(e)).map(t=>({id:t.id,name:t.name,releaseDate:t.releaseDate??null,coverUrl:t.coverUrl??null,score:r[t.id]??null}))}async function A(a,s,e,r){let t=await T(a);if(r?.releaseFrom&&(t=t.filter(n=>(n.releaseDate??"")>=r.releaseFrom)),r?.releaseTo&&(t=t.filter(n=>(n.releaseDate??"")<=r.releaseTo)),r?.hideReleased){const n=new Date().toISOString().split("T")[0];t=t.filter(i=>{const c=i.releaseDate??"";return!c||c>n})}if(r?.search?.trim()){const n=r.search.trim().toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(n))}const o=r?.sortBy??"date",p=(r?.order??"asc")==="asc"?1:-1;t=[...t].sort((n,i)=>{let c=0;if(o==="id")c=(n.id??"").localeCompare(i.id??"");else if(o==="name")c=(n.name??"").localeCompare(i.name??"",void 0,{sensitivity:"base"});else if(o==="date")c=(n.releaseDate??"").localeCompare(i.releaseDate??"");else{const f=n.score??-1/0,y=i.score??-1/0;c=f===y?0:f<y?-1:1}return c*p});const S=t.length;return{games:t.slice(e,e+s),total:S}}async function U(a){const{gamesById:s}=await d();return s.get(a)?.isHidden===!0}async function b(a){const s=h(g,"games",a,"history"),e=R(s,I("date","asc"));return(await C(e)).docs.map(t=>{const o=t.data();return{owners:o.estimatedOwners??0,ownersDelta:o.salesDelta??0,ccu:o.ccu??0,daysSinceRelease:o.daysSinceRelease??0,dailyPoints:o.points??0,date:o.date??t.id}})}async function x(){const{gamesData:a}=await d(),s=new Date().toISOString().split("T")[0];return a.games.filter(e=>!e.isHidden&&e.releaseDate&&e.releaseDate>=s).sort((e,r)=>(e.releaseDate??"").localeCompare(r.releaseDate??"")).map(e=>({...e,id:e.id}))}export{H as a,A as b,x as c,Y as d,q as e,b as g,U as i,F as r};
